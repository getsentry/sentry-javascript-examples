[
  {
    "event_id": "[[ID1]]",
    "sent_at": "[[ISODateString]]",
    "sdk": {
      "name": "sentry.javascript.node",
      "version": "7.110.1"
    },
    "dsn": "[[dsn]]",
    "trace": {
      "environment": "qa",
      "public_key": "[[publicKey]]",
      "trace_id": "[[ID2]]",
      "sample_rate": "1",
      "transaction": "GET /test-local-variables-uncaught",
      "sampled": "true"
    }
  },
  {
    "type": "event"
  },
  {
    "exception": {
      "values": [
        {
          "type": "Error",
          "value": "Uncaught Local Variable Error - {\"randomVariableToRecord\":\"LOCAL_VARIABLE\"}",
          "stacktrace": {
            "frames": [
              {
                "filename": "[[FILENAME1]]",
                "module": "task_queues",
                "function": "process.processTicksAndRejections",
                "lineno": 95,
                "colno": 5,
                "in_app": false
              },
              {
                "filename": "[[FILENAME2]]",
                "module": "fastify.lib:hooks",
                "function": "handleResolve",
                "lineno": 250,
                "colno": 7,
                "in_app": false,
                "pre_context": [
                  "      }",
                  "      if (result && typeof result.then === 'function') {",
                  "        result.then(handleResolve, handleReject)",
                  "      }",
                  "    }",
                  "",
                  "    function handleResolve () {"
                ],
                "context_line": "      next()",
                "post_context": [
                  "    }",
                  "",
                  "    function handleReject (err) {",
                  "      if (!err) {",
                  "        err = new FST_ERR_SEND_UNDEFINED_ERR()",
                  "      }",
                  ""
                ]
              },
              {
                "filename": "[[FILENAME2]]",
                "module": "fastify.lib:hooks",
                "function": "next",
                "lineno": 233,
                "colno": 9,
                "in_app": false,
                "pre_context": [
                  "",
                  "function hookRunnerGenerator (iterator) {",
                  "  return function hookRunner (functions, request, reply, cb) {",
                  "    let i = 0",
                  "",
                  "    function next (err) {",
                  "      if (err || i === functions.length) {"
                ],
                "context_line": "        cb(err, request, reply)",
                "post_context": [
                  "        return",
                  "      }",
                  "",
                  "      let result",
                  "      try {",
                  "        result = iterator(functions[i++], request, reply, next)",
                  "      } catch (error) {"
                ]
              },
              {
                "filename": "[[FILENAME3]]",
                "module": "fastify.lib:route",
                "function": "runPreParsing",
                "lineno": 609,
                "colno": 5,
                "in_app": false,
                "pre_context": [
                  "  }",
                  "",
                  "  request[kRequestPayloadStream] = request.raw",
                  "",
                  "  if (request[kRouteContext].preParsing !== null) {",
                  "    preParsingHookRunner(request[kRouteContext].preParsing, request, reply, handleRequest)",
                  "  } else {"
                ],
                "context_line": "    handleRequest(null, request, reply)",
                "post_context": [
                  "  }",
                  "}",
                  "",
                  "/**",
                  " * Used within the route handler as a `net.Socket.close` event handler.",
                  " * The purpose is to remove a socket from the tracked sockets collection when",
                  " * the socket has naturally timed out."
                ]
              },
              {
                "filename": "[[FILENAME4]]",
                "module": "fastify.lib:handleRequest",
                "function": "handleRequest",
                "lineno": 24,
                "colno": 5,
                "in_app": false,
                "pre_context": [
                  "  }",
                  "",
                  "  const method = request.raw.method",
                  "  const headers = request.headers",
                  "  const context = request[kRouteContext]",
                  "",
                  "  if (method === 'GET' || method === 'HEAD') {"
                ],
                "context_line": "    handler(request, reply)",
                "post_context": [
                  "    return",
                  "  }",
                  "",
                  "  const contentType = headers['content-type']",
                  "",
                  "  if (method === 'POST' || method === 'PUT' || method === 'PATCH' || method === 'TRACE' || method === 'SEARCH') {",
                  "    if (contentType === undefined) {"
                ]
              },
              {
                "filename": "[[FILENAME4]]",
                "module": "fastify.lib:handleRequest",
                "function": "handler",
                "lineno": 75,
                "colno": 7,
                "in_app": false,
                "pre_context": [
                  "      preValidationHookRunner(",
                  "        request[kRouteContext].preValidation,",
                  "        request,",
                  "        reply,",
                  "        preValidationCallback",
                  "      )",
                  "    } else {"
                ],
                "context_line": "      preValidationCallback(null, request, reply)",
                "post_context": [
                  "    }",
                  "  } catch (err) {",
                  "    preValidationCallback(err, request, reply)",
                  "  }",
                  "}",
                  "",
                  "function preValidationCallback (err, request, reply) {"
                ]
              },
              {
                "filename": "[[FILENAME4]]",
                "module": "fastify.lib:handleRequest",
                "function": "preValidationCallback",
                "lineno": 98,
                "colno": 5,
                "in_app": false,
                "pre_context": [
                  "  const validationErr = validateSchema(reply[kRouteContext], request)",
                  "  const isAsync = (validationErr && typeof validationErr.then === 'function') || false",
                  "",
                  "  if (isAsync) {",
                  "    const cb = validationCompleted.bind(null, request, reply)",
                  "    validationErr.then(cb, cb)",
                  "  } else {"
                ],
                "context_line": "    validationCompleted(request, reply, validationErr)",
                "post_context": [
                  "  }",
                  "}",
                  "",
                  "function validationCompleted (request, reply, validationErr) {",
                  "  if (validationErr) {",
                  "    if (reply[kRouteContext].attachValidation === false) {",
                  "      reply.send(validationErr)"
                ]
              },
              {
                "filename": "[[FILENAME4]]",
                "module": "fastify.lib:handleRequest",
                "function": "validationCompleted",
                "lineno": 121,
                "colno": 5,
                "in_app": false,
                "pre_context": [
                  "    preHandlerHookRunner(",
                  "      request[kRouteContext].preHandler,",
                  "      request,",
                  "      reply,",
                  "      preHandlerCallback",
                  "    )",
                  "  } else {"
                ],
                "context_line": "    preHandlerCallback(null, request, reply)",
                "post_context": [
                  "  }",
                  "}",
                  "",
                  "function preHandlerCallback (err, request, reply) {",
                  "  if (reply.sent) return",
                  "",
                  "  if (err != null) {"
                ]
              },
              {
                "filename": "[[FILENAME4]]",
                "module": "fastify.lib:handleRequest",
                "function": "preHandlerCallback",
                "lineno": 137,
                "colno": 37,
                "in_app": false,
                "pre_context": [
                  "    reply.send(err)",
                  "    return",
                  "  }",
                  "",
                  "  let result",
                  "",
                  "  try {"
                ],
                "context_line": "    result = request[kRouteContext].handler(request, reply)",
                "post_context": [
                  "  } catch (err) {",
                  "    reply[kReplyIsError] = true",
                  "    reply.send(err)",
                  "    return",
                  "  }",
                  "",
                  "  if (result !== undefined) {"
                ]
              },
              {
                "filename": "[[FILENAME5]]",
                "module": "app",
                "function": "Object.<anonymous>",
                "lineno": 165,
                "colno": 11,
                "in_app": true,
                "pre_context": [
                  "                    return [2 /*return*/];",
                  "            }",
                  "        });",
                  "    });",
                  "});",
                  "app.get('/test-local-variables-uncaught', function (req, res) {",
                  "    var randomVariableToRecord = 'LOCAL_VARIABLE';"
                ],
                "context_line": "    throw new Error(\"Uncaught Local Variable Error - \".concat(JSON.stringify({ randomVariableToRecord: randomVariableToRecord })));",
                "post_context": [
                  "});",
                  "app.get('/test-local-variables-caught', function (req, res) {",
                  "    var randomVariableToRecord = 'LOCAL_VARIABLE';",
                  "    var exceptionId;",
                  "    try {",
                  "        throw new Error('Local Variable Error');",
                  "    }"
                ]
              }
            ]
          },
          "mechanism": {
            "type": "middleware",
            "handled": false
          }
        }
      ]
    },
    "event_id": "[[ID1]]",
    "platform": "node",
    "contexts": {
      "trace": {
        "data": {
          "sentry.source": "url",
          "sentry.origin": "auto.http.node.tracingHandler",
          "sentry.op": "http.server",
          "sentry.sample_rate": 1
        },
        "op": "http.server",
        "span_id": "[[ID3]]",
        "trace_id": "[[ID2]]",
        "origin": "auto.http.node.tracingHandler"
      },
      "runtime": {
        "name": "node",
        "version": "v20.12.1"
      },
      "app": {
        "app_start_time": "[[ISODateString]]",
        "app_memory": "[[highNumber]]"
      },
      "os": {
        "kernel_version": "23.2.0",
        "name": "macOS",
        "version": "14.2",
        "build": "23C64"
      },
      "device": {
        "boot_time": "[[ISODateString]]",
        "arch": "arm64",
        "memory_size": "[[highNumber]]",
        "free_memory": "[[highNumber]]",
        "processor_count": 10,
        "cpu_description": "Apple M1 Pro",
        "processor_frequency": "[[highNumber]]"
      },
      "culture": {
        "locale": "en-US",
        "timezone": "Europe/Vienna"
      },
      "cloud_resource": {}
    },
    "server_name": "D9M3PY4LQ7.local",
    "timestamp": "[[timestamp]]",
    "environment": "qa",
    "sdk": {
      "integrations": [
        "InboundFilters",
        "FunctionToString",
        "LinkedErrors",
        "RequestData",
        "Console",
        "Http",
        "Undici",
        "OnUncaughtException",
        "OnUnhandledRejection",
        "ContextLines",
        "LocalVariables",
        "Context",
        "Modules"
      ],
      "name": "sentry.javascript.node",
      "version": "7.110.1",
      "packages": [
        {
          "name": "npm:@sentry/node",
          "version": "7.110.1"
        }
      ]
    },
    "tags": {
      "transaction": "GET /test-local-variables-uncaught"
    },
    "request": {
      "method": "GET",
      "cookies": {},
      "headers": {
        "host": "localhost:3030",
        "user-agent": "[[user-agent]]",
        "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8",
        "accept-language": "en-US,en;q=0.5",
        "accept-encoding": "gzip, deflate, br",
        "connection": "keep-alive",
        "upgrade-insecure-requests": "1",
        "sec-fetch-dest": "document",
        "sec-fetch-mode": "navigate",
        "sec-fetch-site": "none",
        "sec-fetch-user": "?1",
        "pragma": "no-cache",
        "cache-control": "no-cache"
      },
      "url": "http://localhost:3030/test-local-variables-uncaught"
    },
    "transaction": "GET /test-local-variables-uncaught",
    "modules": {
      "fastify": "4.26.2",
      "avvio": "8.3.0",
      "fastq": "1.17.1",
      "reusify": "1.0.4",
      "process-warning": "3.0.0",
      "abstract-logging": "2.0.1",
      "pino": "8.20.0",
      "pino-std-serializers": "6.2.2",
      "fast-redact": "3.5.0",
      "quick-format-unescaped": "4.0.4",
      "sonic-boom": "3.8.1",
      "atomic-sleep": "1.0.0",
      "on-exit-leak-free": "2.1.2",
      "thread-stream": "2.4.1",
      "safe-stable-stringify": "2.4.3",
      "rfdc": "1.3.1",
      "fast-json-stringify": "5.14.1",
      "ajv": "8.12.0",
      "fast-deep-equal": "3.1.3",
      "uri-js": "4.4.1",
      "fast-uri": "2.3.0",
      "proxy-addr": "2.0.7",
      "forwarded": "0.2.0",
      "ipaddr.js": "1.9.1",
      "semver": "7.6.0",
      "yallist": "4.0.0",
      "toad-cache": "3.7.0",
      "fast-content-type-parse": "1.1.0",
      "secure-json-parse": "2.7.0",
      "json-schema-ref-resolver": "1.0.1",
      "find-my-way": "8.1.0",
      "fast-querystring": "1.1.2",
      "fast-decode-uri-component": "1.0.1",
      "safe-regex2": "2.0.0",
      "ret": "0.2.2"
    }
  }
]